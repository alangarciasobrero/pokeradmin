<section class="pa-card admin-user-ledger">
  <h1>Libro mayor - {{user.full_name}} (ID: {{user.id}})</h1>

  <section>
    <h2>Saldo</h2>
    <p>Total pagado: {{currency totals.totalPaid}}</p>
    <p>Total inscripciones: {{currency totals.totalRegistrationsCost}}</p>
    <p><strong>Balance: {{currency totals.balance}}</strong> {{#if (gt totals.balance 0)}}(A favor){{else}}(Deuda){{/if}}</p>
  </section>

  <section>
    <h2>Movimientos (Pagos)</h2>
    {{#if payments.length}}
      <table class="pa-table">
        <thead><tr><th>ID</th><th>Fecha</th><th>Tipo</th><th>Monto</th><th>Pagado</th><th>Método</th><th>Registrado por</th><th>Acción</th></tr></thead>
        <tbody>
          {{#each payments}}
            <tr>
              <td>{{this.id}}</td>
              <td>{{formatDate this.payment_date}}</td>
              <td>{{this.source}}{{#if this.reference_id}} #{{this.reference_id}}{{/if}}</td>
              <td>{{currency this.amount}}</td>
              <td>{{currency this.paid_amount}}</td>
              <td>{{methodLabel this.method}}</td>
              <td>{{recordedBy this.method}}</td>
              <td>
                {{#if this.paid}}
                  —
                {{else}}
                  <form method="post" action="/admin/users/{{../user.id}}/payments/{{this.id}}/mark-paid" style="display:inline">
                    <input type="number" step="0.01" name="paid_amount" placeholder="monto" style="width:90px" />
                    <select name="method">
                      <option value="cash">Efectivo</option>
                      <option value="card">Tarjeta</option>
                      <option value="transfer">Transferencia</option>
                      <option value="other">Otro</option>
                    </select>
                    <button type="submit">Registrar pago</button>
                  </form>
                {{/if}}
              </td>
            </tr>
          {{/each}}
        </tbody>
      </table>
    {{else}}
      <p>No hay pagos registrados</p>
    {{/if}}
  </section>

  <section>
    <h2>Inscripciones</h2>
    {{#if registrations.length}}
      <ul>
        {{#each registrations}}
          <li>Torneo ID: {{this.tournament_id}} - Fecha: {{formatDate this.registration_date}}</li>
        {{/each}}
      </ul>
    {{else}}
      <p>No hay inscripciones registradas</p>
    {{/if}}
  </section>
</section>
