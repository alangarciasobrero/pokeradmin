{{!-- Formulario para crear o editar un torneo --}}
<div class="tournament-form-container">
    <h1>{{formTitle}}</h1>
    <form class="tournament-form" action="{{formAction}}" method="POST">
        <label for="tournament_name">Nombre del torneo:</label>
        <input type="text" id="tournament_name" name="tournament_name" value="{{tournament.tournament_name}}" required>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
            <div>
                <label for="start_date">üìÖ Fecha:</label>
                <div style="display:flex;gap:0.5rem;align-items:center;">
                    <input type="text" id="start_date" name="start_date" value="{{formatDateInput tournament.start_date}}" placeholder="dd/mm/yyyy" class="date-input" required style="flex:1;">
                    <button type="button" id="todayBtn" style="padding:0.5rem 1rem;background:#4CAF50;color:white;border:none;border-radius:4px;cursor:pointer;font-weight:600;">Hoy</button>
                </div>
            </div>
            <div>
                <label for="start_time">‚è∞ Hora:</label>
                <input type="time" id="start_time" name="start_time" value="{{formatTimeInput tournament.start_date}}" required style="padding:0.5rem;border:1px solid #ddd;border-radius:4px;width:100%;">
            </div>
        </div>
        <div class="tournament-form-columns">
            <div class="tournament-form-col">
                <label for="buy_in">Buy-in:</label>
                <input type="number" id="buy_in" name="buy_in" value="{{tournament.buy_in}}" required>
                <label for="re_entry">Re-entry:</label>
                <input type="number" id="re_entry" name="re_entry" value="{{tournament.re_entry}}" required>
                <label for="knockout_bounty">Bounty por eliminaci√≥n:</label>
                <input type="number" id="knockout_bounty" name="knockout_bounty" value="{{tournament.knockout_bounty}}" required>
                <label for="starting_stack">Stack inicial:</label>
                <input type="number" id="starting_stack" name="starting_stack" value="{{tournament.starting_stack}}" required>
                <label for="double_points">Doble puntaje:</label>
                <select id="double_points" name="double_points" required>
                    <option value="true" {{#if tournament.double_points}}selected{{/if}}>S√≠</option>
                    <option value="false" {{#unless tournament.double_points}}selected{{/unless}}>No</option>
                </select>
            </div>
            <div class="tournament-form-col">
                <label for="blind_levels">üîÑ Niveles de Re-entry:</label>
                <input type="number" id="blind_levels" name="blind_levels" value="{{tournament.blind_levels}}" required>
                <small style="color:#888;font-size:0.85rem;display:block;margin-top:-5px;margin-bottom:10px;">Cu√°ntos niveles de ciegas antes de cerrar registros</small>
                <label for="small_blind">‚è±Ô∏è Duraci√≥n de cada ciega (minutos):</label>
                <input type="number" id="small_blind" name="small_blind" value="{{#if tournament.small_blind}}{{tournament.small_blind}}{{else}}10{{/if}}" required min="1" max="60">
                <small style="color:#888;font-size:0.85rem;display:block;margin-top:-5px;margin-bottom:10px;">Cu√°nto dura cada nivel de ciega</small>
                <label for="punctuality_apply" class="checkbox-inline">
                    <input type="checkbox" id="punctuality_apply" name="punctuality_apply" {{#if tournament.punctuality_discount}}checked{{/if}}> Aplicar puntualidad
                </label>
                <label for="punctuality_discount">Descuento por puntualidad (%):</label>
                <input type="number" id="punctuality_discount" name="punctuality_discount" value="{{tournament.punctuality_discount}}" min="0" max="100" {{#unless tournament.punctuality_discount}}disabled{{/unless}}>
                <label for="count_to_ranking">Cuenta para ranking:</label>
                <select id="count_to_ranking" name="count_to_ranking" required>
                    <option value="true" {{#if tournament.count_to_ranking}}selected{{/if}}>S√≠</option>
                    <option value="false" {{#unless tournament.count_to_ranking}}selected{{/unless}}>No</option>
                </select>
                <label for="pinned" class="checkbox-inline">
                    <input type="checkbox" id="pinned" name="pinned" {{#if tournament.pinned}}checked{{/if}}> ‚≠ê Destacar en dashboard (m√°ximo 5)
                </label>
                <label for="season_id">Temporada / Ranking:</label>
                <select id="season_id" name="season_id">
                    <option value="">Sin temporada</option>
                    {{#each seasons}}
                    <option value="{{this.id}}" {{#ifEquals this.id ../tournament.season_id}}selected{{/ifEquals}}>
                        {{this.nombre}} ({{formatDate this.fecha_inicio}} - {{formatDate this.fecha_fin}})
                    </option>
                    {{/each}}
                </select>
            </div>
        </div>
        <button type="submit">Guardar</button>
    </form>
</div>

<script src="/js/date-input-validator.js"></script>
<script>
    (function(){
        // Toggle puntualidad
        const chk = document.getElementById('punctuality_apply');
        const input = document.getElementById('punctuality_discount');
        if (chk && input) {
            function toggle() {
                if (chk.checked) {
                    input.removeAttribute('disabled');
                    if (!input.value) input.value = '20';
                } else {
                    input.setAttribute('disabled','disabled');
                }
            }
            chk.addEventListener('change', toggle);
            toggle();
        }
        
        // Bot√≥n "Hoy"
        const todayBtn = document.getElementById('todayBtn');
        const dateInput = document.getElementById('start_date');
        if (todayBtn && dateInput) {
            todayBtn.addEventListener('click', function() {
                const today = new Date();
                const day = String(today.getDate()).padStart(2, '0');
                const month = String(today.getMonth() + 1).padStart(2, '0');
                const year = today.getFullYear();
                dateInput.value = `${day}/${month}/${year}`;
                dateInput.classList.remove('invalid');
            });
        }
    })();
</script>
